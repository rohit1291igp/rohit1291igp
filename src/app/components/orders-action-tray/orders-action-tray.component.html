<div class="image-preview" *ngIf="imagePreviewFlag">
    <div class="modal fade in" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: block; overflow:scroll; background: rgba(0, 0, 0, 0.77);" (click)="imagePreview($event)">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" (click)="imagePreview($event, 'ignore')">
                <div class="modal-header" style="border-bottom:none;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="imagePreview($event)"><span aria-hidden="true">×</span></button>
                    <!--<h4 class="modal-title" id="myModalLabel">Modal Header</h4>-->
                </div>
                <div class="modal-body center-align">
                    <img class="img-responsive" src="{{imagePreviewSrc}}" alt="product_img_preview">

                    <!--<p>Some text in the modal.</p>-->
                </div>
                <!--<div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>-->
            </div>
        </div>
    </div>
    <!--<div class="modal-backdrop fade in" (click)="imagePreview($event)"></div>-->
</div>

<div class="image-preview" *ngIf="statusMessageFlag">
    <div class="modal fade in" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: block; overflow:scroll; background: rgba(0, 0, 0, 0.77);"  (click)="closePopup($event)">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" (click)="closePopup($event, 'ignore')">
                <div class="modal-header" style="border-bottom:none;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closePopup($event)"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="myModalLabel" *ngIf="statusReasonModel.status === 'Rejected'">Reason for reject</h4>
                    <h4 class="modal-title" id="myModalLabel" *ngIf="statusReasonModel.status === 'Delivered'">Recipient's Details</h4>
                </div>

                <div class="modal-body center-align" *ngIf="statusReasonModel.status === 'Rejected'">
                    <div class="form-group">
                        <form (ngSubmit)="f.form.valid && statusReasonSubmit($event)" #f="ngForm" nonvalidate>

                            <select name="rejectopt" class="form-control" [(ngModel)]="statusReasonModel.rejectOption" #rejectopt="ngModel" required>
                                <option *ngFor="let reason of rejectReasons" [ngValue]="reason.value">{{reason.name}}</option>
                            </select>
                            <div *ngIf="f.submitted && !rejectopt.valid" class="help-block theme-red">Select one of the reject reason</div>

                            <div *ngIf="statusReasonModel.rejectOption == 'Other'">
                            <textarea name="message" class="form-control custom-control m-top-1" rows="3" style="resize:none" [(ngModel)]="statusReasonModel.message" #message="ngModel" placeholder="Reason for reject" required></textarea>
                            <div *ngIf="f.submitted && !message.valid" class="help-block theme-red">Reject reason is required</div>
                            </div>

                            <button class="btn btn-primary m-top-1">Reject</button>
                        </form>
                    </div>
                </div>

                <div class="modal-body center-align" *ngIf="statusReasonModel.status === 'Delivered'">
                    <div class="form-group">
                        <form (ngSubmit)="f.form.valid && statusReasonSubmit($event)" #f="ngForm" nonvalidate>
                            <input name="recipientName" class="form-control custom-control" [(ngModel)]="statusReasonModel.recipientName" #recipientName="ngModel" placeholder="Recipient's name" required>
                            <textarea name="message" class="form-control custom-control m-top-1" rows="3" style="resize:none" [(ngModel)]="statusReasonModel.recipientComments" #message="ngModel" placeholder="comment" required></textarea>
                            <button class="btn btn-primary m-top-1" [ngClass]="{'markdlvBtn' : !trayOpen}">Mark as Delivered</button>
                            <div *ngIf="f.submitted && !message.valid" class="help-block"></div>
                        </form>
                        <button class="btn btn-primary m-top-1 viewDetailPopupBtn" *ngIf="!trayOpen" (click)="toggleTray($event, 'OutForDeliveryView', statusReasonModel.orderId, null)">View Detail</button>
                        <div *ngIf="f.submitted && !message.valid" class="help-block theme-red">Recipient's details is required</div>
                    </div>
                </div>

                <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
                <!--</div>-->
            </div>
        </div>
    </div>
</div>


<div id="mainOrderSection" class="orders-action" [ngClass]="{'show-tray': trayOpen, 'hide-tray': !trayOpen}" >
<div class="apierror" *ngIf="apierror">{{apierror}}</div>
  <div class="container-fluid orders-view">
    <div class="row sidePanelHeader">
      <div class="colInline col-sm-1 col-md-1">
        <a href="#" (click)="toggleTray($event, null, null)" [attr.data-trayOpen]="trayOpen">
          <i class="glyphicon glyphicon-remove close-tray"></i>
        </a>
      </div>

        <div class="colInline col-sm-11 col-md-11 no-padding">
            <p class="text-bold ">
                <span *ngIf="!orderByStatus">Order Information<span *ngIf="sidePanelData">({{sidePanelData[0].orderId}})</span></span>
                <span *ngIf="orderByStatus">
                     <span class="" *ngIf="orderUpdateByTime == 'past'">Past - </span>
                     <span class="" *ngIf="orderByStatus == 'Processed'">New Orders (To be confirmed)</span>
                     <span class="" *ngIf="orderByStatus == 'Confirmed'">Confirmed Orders (To be delivered)</span>
                     <span class="" *ngIf="orderByStatus == 'OutForDelivery'">Orders out for delivery</span>
                     <span class="" *ngIf="orderByStatus == 'Shipped'">Orders delivered today</span>
                </span>
                <!--<span *ngIf="orderUpdateByTime">
                    <span class="uppercase" *ngIf="orderUpdateByTime == 'past'"> - Delivery for today</span>
                    <span class="uppercase" *ngIf="orderUpdateByTime == 'today'"> - Delivery for today</span>
                    <span class="uppercase" *ngIf="orderUpdateByTime == 'tomorrow'"> - Delivery for tomorrow</span>
                    <span class="uppercase" *ngIf="orderUpdateByTime == 'future'"> - Delivery for future</span>
                    <span class="uppercase" *ngIf="orderUpdateByTime == 'bydate'"> - Delivery by date </span>
                </span>-->

                <!--- Delivery for today  {{orderId}}-->
            </p>
            <p class="text-grey no-margin">Total - <span *ngIf="!sidePanelData">0</span><span *ngIf="sidePanelData">{{sidePanelData.length}}</span> Orders</p>

        </div>

    </div>
    <div class="row sidePanelContent">
        <div *ngIf="!sidePanelData">
            <div class="col-md-12 order-row" *ngFor="let loaderc of loadercount" style="margin-bottom: 0;">
                    <div class="container-fluid orders-tray" >
                        <div class="row delivery-details">
                            <div class="col-md-8 order-details no-padding">
                                <p>

                                    <span class="order-id">Order ID: <app-loader></app-loader></span>
                                    <span class="delivery-time">Same Day Delivery <app-loader></app-loader></span>
                                </p>
                                <div class="text-bold">Deliver to: <app-loader></app-loader></div>
                                <div class="address">Address - <app-loader></app-loader></div>
                                <div class="contact">CONTACT NUMBER - <app-loader></app-loader></div>
                            </div>
                            <div class="col-md-4 order-actions">
                                <div class="row">
                                    <div class="btn btn-primary actions-button uppercase text-bold text-black bg-white disableBtn">
                                    Reject
                                </div>
                                <div class="btn btn-primary actions-button uppercase text-bold text-white bg-green disableBtn">
                                Confirm
                            </div>
                        </div>
                        <div class="row">
                            <div class="btn btn-primary actions-button text-bold disableBtn" [ngClass]="{'bg-igp text-white': isAlert, 'bg-grey text-black': !isAlert}">
                            Print Order
                        </div>
                        <div class="btn btn-primary actions-button text-bold disableBtn" [ngClass]="{'bg-igp text-white': isAlert, 'bg-grey text-black': !isAlert}">
                        Print Message
                    </div>
                </div>

                   <!-- <div class="row">
                        <div class="btn btn-primary actions-button text-bold">
                            Order Instruction
                        </div>
                    </div>-->
                  <!--<div class="row">
                      <div class="btn btn-primary actions-button text-bold text-white bg-black disableBtn">
                          Price Change Request
                      </div>
                      &lt;!&ndash;<div class="btn btn-primary actions-button text-bold text-white bg-black">
                            Other
                      </div>&ndash;&gt;
                  </div>-->
            </div>
            </div>
            <div class="row">
                <p>Product Name: <span class="uppercase text-igp"><app-loader></app-loader></span></p>
                <!--<p>Product Components -</p>-->
                <div class="col-md-12 product-holder noBtBorder">
                    <div class="row">
                        <div class="col-md-4 no-padding">
                            <div class="product-component mainprod">
                                <div class="component-head">&nbsp;</div>
                                <app-loader [loaderType]="'compsmallboxImg'"></app-loader>
                                <div class="component-quantity" style="background:#eee;">&nbsp;</div>
                                <div class="component-name">&nbsp; <br/> &nbsp;</div>
                            </div>
                            <div class="table-inline-display plus-sign" style="padding-left: 9%;">
                               <div class="table-cell-display v-align-middle"> =</div>
                            </div>
                        </div>
                        <div class="col-md-8 no-padding">
                            <div class="product-component">
                                <div class="component-head">&nbsp;</div>
                                <app-loader [loaderType]="'compsmallboxImg'"></app-loader>
                                <div class="component-quantity" style="background:#eee;">&nbsp;</div>
                                <div class="component-name">&nbsp; <br/> &nbsp;</div>
                            </div>
                            <div class="table-inline-display plus-sign" style="">
                                <div class="table-cell-display v-align-middle">+</div>
                            </div>
                            <div class="product-component">
                                <div class="component-head">&nbsp;</div>
                                <app-loader [loaderType]="'compsmallboxImg'"></app-loader>
                                <div class="component-quantity" style="background:#eee;">&nbsp;</div>
                                <div class="component-name">&nbsp; <br/> &nbsp;</div>
                            </div>
                            <div class="table-inline-display plus-sign" style="">
                                <div class="table-cell-display v-align-middle">+</div>
                            </div>
                            <div class="product-component">
                                <div class="component-head">&nbsp;</div>
                                <app-loader [loaderType]="'compsmallboxImg'"></app-loader>
                                <div class="component-quantity" style="background:#eee;">&nbsp;</div>
                                <div class="component-name">&nbsp; <br/> &nbsp;</div>
                            </div>
                            <div class="table-inline-display plus-sign" style="">
                                <div class="table-cell-display v-align-middle">+</div>
                            </div>
                            <div class="product-component">
                                <div class="component-head">&nbsp;</div>
                                <app-loader [loaderType]="'compsmallboxImg'"></app-loader>
                                <div class="component-quantity" style="background:#eee;">&nbsp;</div>
                                <div class="component-name">&nbsp; <br/> &nbsp;</div>
                            </div>
                            <div class="table-inline-display plus-sign" style="">
                                <div class="table-cell-display v-align-middle">+</div>
                            </div>
                            <div class="product-component">
                                <div class="component-head">&nbsp;</div>
                                <app-loader [loaderType]="'compsmallboxImg'"></app-loader>
                                <div class="component-quantity" style="background:#eee;">&nbsp;</div>
                                <div class="component-name">&nbsp; <br/> &nbsp;</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            </div>
        </div>
        <div *ngIf="sidePanelData">
            <div  id="order-{{order.orderId}}" class="col-md-12 order-row" *ngFor="let order of sidePanelData" style="margin-bottom: 0;" [@anim]="order.state">

                <div class=" triangle-topright" [ngClass]="{'redBorder' : order.orderProducts[0].alertFlag, 'greenBorder' : order.orderProducts[0].slaFlag}">
                    <div class="slaAlert-flag abs" *ngIf="order.orderProducts[0].alertFlag">High Alert</div>
                    <div class="slaAlert-flag abs" *ngIf="order.orderProducts[0].slaFlag">Action Required</div>
                </div>

                <!-- Print Template start -->
                    <app-print-template [order]="order" [printType]="'order'"></app-print-template>
                    <app-print-template [order]="order" [printType]="'orderMessage'"></app-print-template>
                <!-- Print Template end -->
                <div class="container-fluid orders-tray">
                  <div class="row delivery-details">
                    <div class="col-md-8 order-details no-padding">
                      <p>
                        <span class="order-id">
                            Order ID: {{order.orderId}}
                        </span>
                        <span>
                            <span class="" *ngIf="order.orderProducts[0].ordersProductStatus == 'Processed'">(New Order)</span>
                            <span class="" *ngIf="order.orderProducts[0].ordersProductStatus == 'Confirmed'">(Confirmed Order)</span>
                            <span class="" *ngIf="order.orderProducts[0].ordersProductStatus == 'Shipped' && order.orderProducts[0].deliveryStatus === 0">(Out for delivery Order)</span>
                            <span class="" *ngIf="order.orderProducts[0].ordersProductStatus == 'Shipped' && order.orderProducts[0].deliveryStatus === 1">(Delivered order)</span>
                        </span>
                        <!--<span class="delivery-time">Same Day Delivery 12/4/17 2:00 PM</span>-->
                          <span class="dtm" *ngIf="order && order.orderProducts[0] && order.orderProducts[0].orderProductExtraInfo">
                              <span class="uppercase delivery-time text-bold" attr.data-dt="{{order.orderProducts[0].orderProductExtraInfo.deliveryDate}}" attr.data-pd="{{order.datePurchased}}" >{{getDeliveryDetail(order.orderProducts[0].orderProductExtraInfo, order.datePurchased)}}</span>
                          </span>
                      </p>
                      <div class="text-bold">Deliver to: {{order.deliveryName}}</div>
                      <div class="address">{{order.addressType}} Address - {{order.deliveryStreetAddress}}, <span *ngIf="order.deliveryStreetAddress2">{{order.deliveryStreetAddress2}},</span>{{order.deliveryCity}}-{{order.deliveryPostcode}}, {{order.deliveryState}}</div>
                      <div class="contact">CONTACT NUMBER - {{order.deliveryMobile}}</div>
                    </div>
                    <div class="col-md-4 order-actions">
                      <div class="row">
                        <div class="btn  actions-button uppercase text-bold bg-white text-red" [ngClass]="{'disableBtn' : order.orderProducts[0].ordersProductStatus !=='Processed', 'hide' : order.orderProducts[0].ordersProductStatus !=='Processed'}" (click)="updateOrderStatus($event, 'Rejected', order.orderId, order.orderProducts, order.orderProducts[0].orderProductExtraInfo.deliveryDate, order.orderProducts[0].orderProductExtraInfo.deliveryTime)">
                          Reject
                        </div>
                        <button class="btn btn-primary actions-button uppercase text-bold text-white bg-green"
                        [ngClass]="{'disableBtn' : (order.orderProducts[0].ordersProductStatus =='Shipped' && order.orderProducts[0].deliveryStatus === 1) ||
                        (order.orderProducts[0].ordersProductStatus =='Dispatched' && order.orderProducts[0].deliveryStatus === 1) ||
                        (order.orderProducts[0].ordersProductStatus =='Confirmed' && order.deliverWhen !== 'today' && order.deliverWhen !== 'past')}"
                        (click)="updateOrderStatus($event, getNxtOrderStatus(order.orderProducts[0].ordersProductStatus), order.orderId, order.orderProducts, order.orderProducts[0].orderProductExtraInfo.deliveryDate, order.orderProducts[0].orderProductExtraInfo.deliveryTime)">
                              <span *ngIf="order.orderProducts[0].ordersProductStatus =='Processed'">Confirm</span>
                              <span *ngIf="order.orderProducts[0].ordersProductStatus =='Confirmed'">Out For Delivery</span>
                              <span *ngIf="(order.orderProducts[0].ordersProductStatus =='Shipped' && order.orderProducts[0].deliveryStatus === 0) || order.orderProducts[0].ordersProductStatus =='OutForDelivery' || order.orderProducts[0].ordersProductStatus == 'Partially Dispatched'">Mark as Delivered</span>
                              <span *ngIf="(order.orderProducts[0].ordersProductStatus =='Shipped' && order.orderProducts[0].deliveryStatus === 1)  || (order.orderProducts[0].ordersProductStatus =='Dispatched' && order.orderProducts[0].deliveryStatus === 1)">Mark as Delivered</span>
                        </button>
                      </div>

                      <!--<div class="row">
                        <div class="btn btn-primary actions-button text-bold text-white bg-black disableBtn " [ngClass]="{'disableBtn1' : !(order.orderProducts[0].ordersProductStatus =='Processed' || order.orderProducts[0].ordersProductStatus =='Confirmed'), 'hide' : !(order.orderProducts[0].ordersProductStatus =='Confirmed' || order.orderProducts[0].ordersProductStatus =='Processed') }" (click)="updateOrderStatus($event, 'PutOnHold', order.orderId)">
                          Price Change Request
                        </div>
                        &lt;!&ndash;<div class="btn btn-primary actions-button text-bold text-white bg-black">
                          Other
                        </div>&ndash;&gt;
                      </div>-->

                    <div class="row">
                        <div class="btn btn-primary actions-button text-bold" [ngClass]="{'bg-igp text-white': isAlert, 'bg-grey text-black': !isAlert}" (click)="print($event, 'order', order.orderId)">
                        Print Order
                    </div>
                    <div class="btn btn-primary actions-button text-bold" [ngClass]="{'bg-igp text-white': isAlert, 'bg-grey text-black': !isAlert, 'disableBtn' : !order.commments}" (click)="print($event, 'order_message', order.orderId)">
                    Print Message
                    </div>
                    </div>

                    <div class="row instruction-cont relative" *ngIf="order.orderInstruction">

                        <div class="btn btn-primary actions-button text-bold">
                            Order Instruction
                        </div>

                        <div class="order-instruction-detail">
                            <div class="arrow-up abs"></div>
                            <div>{{order.orderInstruction}}</div>
                        </div>
                    </div>

                    <!--<div class="row">-->
                        <!--<button type="button" class="btn btn-lg btn-danger" data-toggle="popover" title="Popover title" data-content="And here's some amazing content. It's very engaging. Right?">Click to toggle popover</button>-->
                    <!--</div>-->

                    </div>
                  </div>
                  <div class="row" *ngFor="let orderProduct of order.orderProducts; let z='index'">
                    <p class="">
                        Product Name:
                        <!--<a target="_new" href="https://www.igp.com/{{orderProduct.productNameForUrl}}">-->
                            <span class="uppercase text-igp">{{orderProduct.productName}}</span>
                            <span class="" *ngIf="orderProduct.products_code">({{orderProduct.products_code}})  </span>
                        <!--</a>-->
                        <span class="" style="" *ngIf="orderProduct.personalized"> | <a target="_new" href="http://admin.indiangiftsportal.com/myshop/persInfo.php?pid={{orderProduct.productId}}&oid={{order.orderId}}">Download Photo</a></span>
                    </p>
                    <!--<p>Product Components -</p>-->
                    <div class="col-md-12 product-holder" [ngClass]="{'noBtBorder' : (z+1 === order.orderProducts.length)}">
                      <div class="row">
                          <div class="col-md-12 no-padding comp1">
                        <!--<div class="col-md-3 no-padding comp1">-->
                           <span>
                                <div class="product-main relative">
                                    <div class="component-eggless prod-img abs" *ngIf="orderProduct.productQuantity>1">X {{orderProduct.productQuantity}}</div>
                                    <img class="product-image clk" src="{{productsURL}}{{orderProduct.productImage}}" alt="product_img" (click)="imagePreview($event, productsURL+(orderProduct.productImage))">
                                    <div class="price-display">Rs. {{orderProduct.vendorPrice}}</div>
                                </div>
                                <div class="equal-sign table-inline-display" *ngIf="orderProduct.componentList.length">
                                   <div class="table-cell-display v-align-middle">=</div>
                                </div>
                           </span>
                        <!--</div>-->
                        <!--<div class="col-md-8 no-padding comp2">-->
                          <span *ngFor="let prodComponent of orderProduct.componentList; let i='index'">
                              <div class="product-component relative">
                                  <div class="component-eggless abs" *ngIf="prodComponent.eggless">Eggless</div>
                                <!--<div class="component-head center-align uppercase">{{prodComponent.componentCode | slice:0:9}}<span *ngIf="prodComponent.componentName.length > 9">...</span></div>-->
                                <img class="component-image clk" src="{{productsCompURL}}th/{{prodComponent.componentImage}}" alt="Component_img" (click)="imagePreview($event, productsCompURL+'full/'+(prodComponent.componentImage))">
                                <div class="component-quantity center-align">x {{prodComponent.quantity | number | replace}}</div>
                                <div class="component-name center-align">{{prodComponent.componentName}} </div>
                                <div class="price-display" *ngIf="prodComponent.componentPrice && prodComponent.componentPrice !== 'N/A' && prodComponent.componentName !== 'Adjustment' " style="margin-top: 6px; font-size: 0.80em;">{{prodComponent.componentPrice | number | replace}}x{{prodComponent.quantity | number}}={{prodComponent.componentPrice  * prodComponent.quantity}}</div>
                                <div class="price-display" *ngIf="prodComponent.componentPrice && prodComponent.componentPrice !== 'N/A' && prodComponent.componentName === 'Adjustment'" style="margin-top: 6px; font-size: 0.80em;">Rs. {{prodComponent.componentPrice | number | replace}}</div>
                              </div>
                              <div class="table-inline-display plus-sign" *ngIf="(i+1) !== orderProduct.componentList.length">
                                <div class="table-cell-display v-align-middle">+</div>
                              </div>
                          </span>
                        <!--</div>-->
                            </div>
                      </div>
                    </div>
                  </div>
                    <div class="row">
                        <div class="col-md-4 pull-left text-bold">
                            <div>Net Product Price  <span style="margin-left:0.1em;">
                                <span class="theme-red rightAlignrdNumber" *ngIf="order.vendorOrderTotal" [style.width]="(order.vendorOrderTotal).toString().length < 4 ? '3.5em': (order.vendorOrderTotal).toString().length+'em' ">Rs. <span class="pull-right">{{order.orderNetProductPrice | number : '2.0-0' | replace}}</span></span></span>
                            </div>
                            <div style="margin-top:0.5em;">Delivery Charges <span style="margin-left:0.5em;">  <span class="theme-red rightAlignrdNumber" *ngIf="order.vendorOrderTotal" [style.width]="(order.vendorOrderTotal).toString().length < 4 ? '3.5em': (order.vendorOrderTotal).toString().length+'em' ">  Rs. <span class="pull-right">{{order.vendorDeliveryCharge | number : '2.0-0' | replace}}</span></span></span></div>
                            <div class="" style="margin-top:0.5em;">Total Order Value <span style="margin-left:0.5em;">  <span class="theme-red rightAlignrdNumber" *ngIf="order.vendorOrderTotal" [style.width]="(order.vendorOrderTotal).toString().length < 4 ? '3.5em': (order.vendorOrderTotal).toString().length+'em' ">Rs. <span class="pull-right">{{order.vendorOrderTotal | number : '2.0-0' | replace}}</span></span></span></div>
                            <!--<div class="" style="margin-top:0.5em;">Price Adjustment <span style="margin-left:0;"> - <span class="theme-red">Rs. {{order.priceAdjustment | number : '2.0-0'}}</span></span></div>-->
                        </div>
                        <div class="col-md-4">&nbsp;</div>
                        <div class="col-md-4 text-bold">
                        </div>
                    </div>
                </div>
             </div>
        </div>
    </div>
  </div>

</div>

