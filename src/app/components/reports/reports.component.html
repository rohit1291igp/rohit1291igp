<app-widgets (onConfirmClicked)="confirmYesNo($event)" [wOptions]="{type : 'confirm', data:confirmData}" *ngIf="confirmFlag" [@enterAnimation]></app-widgets>

<div class="pdfSection" id="pdf-section" *ngIf="pdfDwldFlag && pdfData">
    <div class="pdfHead">
        <div class="pull-left vendorName">{{vendorName}}</div>
        <div class="pull-right">
            <div><span class="text-bold">Order Id : </span> {{pdfData.orderId}}</div>
            <div><span class="text-bold">Invoice No. :</span> {{pdfData.invoiceNumber}}</div>
            <div><span class="text-bold">Date :</span> {{pdfData.datePurchased | date : 'dd/MM/yy'}}</div>
        </div>
        <div class="clearfix"></div>
    </div>

    <div class="pdfAddr">
        <div class="pull-left leftSide">
            <div><span class="text-bold">To:</span></div>
            <div>{{pdfData.billingAddress.name}}</div>
            <div>{{pdfData.billingAddress.address}}</div>
            <div>{{pdfData.billingAddress.email}}</div>
            <div>{{pdfData.billingAddress.ph}}</div>
            <div><span class="text-bold">PAN No. :</span> {{pdfData.billingAddress.pan}}</div>
            <div><span class="text-bold">GST Registration No. :</span> {{pdfData.billingAddress.gstn}}</div>
        </div>
        <div class="pull-right rightSide">
            <div><span class="text-bold">By:</span></div>
            <div>{{pdfData.sellerAddress.name}}</div>
            <div>{{pdfData.sellerAddress.address}}</div>
            <div>{{pdfData.sellerAddress.email}}</div>
            <div>{{pdfData.sellerAddress.ph}}</div>
            <div><span class="text-bold">PAN No. :</span> {{pdfData.sellerAddress.pan}}</div>
            <div><span class="text-bold">GST Registration No. :</span> {{pdfData.sellerAddress.gstn}}</div>
        </div>
        <div class="clearfix"></div>
    </div>

    <div class="pdfTable">
        <table class="table table-bordered" style="width:100%;">
            <thead>
                <th>Product Name</th>
                <th>Unit Price</th>
                <th>Quantity</th>
                <th>Net Amount</th>
                <th>Tax Rate</th>
                <th>Tax Code</th>
                <th>Tax Type</th>
                <th>Tax Amount</th>
                <th>Total Amount</th>
                <!--<th>Total</th>-->
            </thead>
            <tbody>
                <tr *ngFor="let prod of pdfData.productDetail">
                    <td>{{prod.productName}}</td>
                    <td>{{prod.unitPrice}}</td>
                    <td>{{prod.quantity}}</td>
                    <td>Rs. <span [innerHTML]="prod.netAmount"></span></td>
                    <td><span [innerHTML]="prod.taxrate"></span></td>
                    <td><span [innerHTML]="prod.taxCode"></span></td>
                    <td><span [innerHTML]="prod.taxType"></span></td>
                    <td>Rs. <span [innerHTML]="prod.taxAmount"></span></td>
                    <td>Rs. <span [innerHTML]="prod.totalAmount"></span></td>
                    <!--<td>{{prod.total}}</td>-->
                </tr>
                <tr>
                    <td colspan="3"><span class="text-bold">Total</span></td>
                    <td ><span class="text-bold">Rs. {{pdfData.totalNetAmount}}</span></td>
                    <td colspan="3"></td>
                    <td ><span class="text-bold">Rs. {{pdfData.totalTaxAmount}}</span></td>
                    <td ><span class="text-bold">Rs. {{pdfData.total}}</span></td>
                </tr>
            </tbody>
        </table>

    </div>

    <div class="pdfFooter">
        <p>This is computer generated invoice.</p>
        <p>E. & O.E.</p>
    </div>
</div>

<div class="image-preview" *ngIf="imagePreviewFlag">
<div class="modal fade in" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: block; overflow:scroll; background: rgba(0, 0, 0, 0.77); z-index:9999999;" (click)="imagePreview($event)">
<div class="modal-dialog modal-lg">
    <div class="modal-content" (click)="imagePreview($event, 'ignore')" [ngClass]="{'mHeight' : isMobile, 'cHeight' : !isMobile}">
    <div class="modal-header" style="border-bottom:none;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="imagePreview($event)"><span aria-hidden="true">×</span></button>
        <!--<h4 class="modal-title" id="myModalLabel">Modal Header</h4>-->
    </div>
    <div class="modal-body center-align">
        <img class="img-responsive" src="{{imagePreviewSrc}}" alt="product_img_preview">

        <!--<p>Some text in the modal.</p>-->
    </div>
    <!--<div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>-->
</div>
</div>
</div>
<!--<div class="modal-backdrop fade in" (click)="imagePreview($event)"></div>-->
</div>


<div class="image-preview" *ngIf="editTableCell">
<div class="modal fade in" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: block; overflow:scroll; background: rgba(0, 0, 0, 0.77); z-index:9999999;" (click)="closePopup($event)">
<div class="modal-dialog modal-lg popupSize1">
    <div class="modal-content" (click)="closePopup($event, 'ignore')" [ngClass]="{'mHeight' : isMobile, 'cHeight' : !isMobile}">
    <div class="modal-header" style="border-bottom:none;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closePopup($event)"><span aria-hidden="true">×</span></button>
        <h4 class="modal-title" id="myModalLabel">Edit {{editTableCellObj.caption}} <ng-container *ngIf="reportType === 'getPincodeReport'">Price</ng-container></h4>
    </div>
    <div class="modal-body center-align">
        <!--<label>{{editTableCellObj.caption}}:</label>-->
        <form (ngSubmit)="f.form.valid && submitEditCell($event, editTableCellObj.actBtnTxt, editTableCellObj.cellValue, editTableCellObj.rowData, editTableCellObj.header, editTableCellObj.dataIndex)" #f="ngForm" nonvalidate>
            <input class="form-control custom-control" type="text" name="editTableCell" placeholder="{{editTableCellObj.caption}}" [(ngModel)]="editTableCellObj.value" #editTableCell="ngModel" required>
            <div *ngIf="f.submitted && !editTableCell.valid" class="help-block theme-red">Please provide {{editTableCellObj.caption}} value</div>
            <button class="btn btn-primary m-top-1">Save</button>
        </form>
    </div>
    <!--<div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>-->
</div>
</div>
</div>
<!--<div class="modal-backdrop fade in" (click)="imagePreview($event)"></div>-->
</div>


<div class="row padding-extra dbTableHeader">
    <p style="font-weight: bold; padding: 0.5em 2.5em 0;">Hi {{vendorName}} !</p>
</div>

<div class="container-fluid reports-cont" *ngIf="!reportData">
    <div class="row">
        <div class="col-sm-12 col-md-12 m-top-1" *ngIf="reportType === 'getOrderReport' || reportType === 'getPayoutAndTaxesReport' " style="width:100%;">

         <div class="col-sm-9 col-md-9 reprts-search-fields bg-white padding1" style="width:74.5%; margin-right:0.5%;">
                <div class="underLine paddingHalf text-bold">Search Parameters</div>
                <form name="searchReport" (ngSubmit)="f.form.valid && searchReportSubmit($event)" #f="ngForm" nonvalidate>
                    <div class="searchFields m-top-1 inline">
                        <div class="searchFiled inline" *ngFor="let searchField of reportDataLoader.searchFields;">
                            <select class="form-control" name="{{searchField.name}}"  [(ngModel)]="searchResultModel[searchField.name]" *ngIf="searchField.name === 'status'">
                                <option *ngFor="let statusName of statusList" [ngValue]="statusName.value" [attr.data-trayOpen]="statusName.type">{{statusName.name}}</option>
                            </select>
                            <input class="form-control" type="text" name="{{searchField.name}}" placeholder="{{searchField.placeholder}}" [(ngModel)]="searchResultModel[searchField.name]" *ngIf="(searchField.type === 'text' || searchField.type === 'number') && searchField.name != 'status'">
                            <my-date-picker id="{{searchField.name}}" name="{{searchField.name}}" placeholder="{{searchField.placeholder}}" [options]="myDatePickerOptions" [(ngModel)]="searchResultModel[searchField.name]"  *ngIf="searchField.type === 'date' && searchField.name != 'status'"></my-date-picker>
                        </div>
                    </div>
                    <div class="searchFieldsSubmit relative inline">
                        <input  type="submit" class="btn btn-primary pull-right bg-igp searchSubmitBtn"  value="Search All Parameters" />
                    </div>
                </form>
         </div>

        <div class="col-sm-3 col-md-3 reprts-summary bg-white padding1" style="width:25%;">
            <div class="underLine paddingHalf text-bold">Summary</div>
            <div class="summaryBlockCont">
                <div class="summaryBlock inline m-top-1" *ngFor="let summ of reportDataLoader.summary; index as i;">
                    <div class="icon l" aria-hidden="true">
                        <img src="assets/images/icons/gift.svg" alt="orders" *ngIf="i === 0">
                        <img src="assets/images/icons/inr.svg" alt="inr" *ngIf="i === 1">
                        <img src="assets/images/icons/inr.svg" alt="inr" *ngIf="i === 2">
                    </div>
                    <div class="text-igp">{{summ.label}}</div>
                    <div class="text-bold">{{summ.value}}</div>
                </div>
            </div>
    </div>

    </div>
    <div class="col-sm-12 col-md-12 table-cont m-top-2 table-fixed">
        <table class="report-table table table-striped table-bordered table-curved table-fixed">
            <thead class="bg-igp text-white">
            <tr>
                <th *ngFor="let tableLabel of reportDataLoader.tableHeaders">
                {{tableLabel}} <span>&nbsp;&nbsp;</span>
                <!--<span class="glyphicon glyphicon-chevron-down"></span>-->
                </th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let tableRowValue of reportDataLoader.tableData">
            <td  class="bg-loader" *ngFor="let tableCol of tableRowValue; let i='index'">
            <span>&nbsp;&nbsp;</span>
            <!--<span class="glyphicon glyphicon-eye-open" *ngIf="i === 0"></span>-->
            </td>
            </tr>

            </tbody>
        </table>
    </div>

    </div>
</div>

<div class="container-fluid reports-cont" *ngIf="reportData">
    <div class="row">
        <div class="col-sm-12 col-md-12 m-top-1" *ngIf="reportType === 'getOrderReport' || reportType === 'getPayoutAndTaxesReport' " style="width:100%; height:14em;">

            <div class="col-sm-9 col-md-9 reprts-search-fields bg-white padding1" style="margin-right:0.5%; height:100%;" [style.width]="(getTopBlockWidth()).left">
                <div class="underLine paddingHalf text-bold">Search Parameters</div>
                <form name="searchReport" (ngSubmit)="f.form.valid && searchReportSubmit($event)" #f="ngForm" nonvalidate>
                    <div class="searchFields m-top-1 inline">
                        <div class="searchFiled pull-left" *ngFor="let searchField of reportData.searchFields;" >
                            <select class="form-control" name="{{searchField.name}}"  [(ngModel)]="searchResultModel[searchField.name]" *ngIf="searchField.name === 'status'">
                                <option *ngFor="let statusName of statusList" [ngValue]="statusName.value" [attr.data-trayOpen]="statusName.type">{{statusName.name}}</option>
                            </select>
                            <input class="form-control" type="text" name="{{searchField.name}}" placeholder="{{searchField.placeholder}}" [(ngModel)]="searchResultModel[searchField.name]" *ngIf="(searchField.type === 'text' || searchField.type === 'number') && searchField.name != 'status'">
                            <my-date-picker id="{{searchField.name}}" name="{{searchField.name}}" placeholder="{{searchField.placeholder}}" [options]="myDatePickerOptions" [(ngModel)]="searchResultModel[searchField.name]"  *ngIf="searchField.type === 'date' && searchField.name != 'status'"></my-date-picker>
                        </div>

                        <div class="searchFiled pull-left" *ngIf="reportType === 'getOrderReport' " >
                            <select class="form-control" name="status"  [(ngModel)]="searchResultModel['status']">
                                <option *ngFor="let statusName of statusList" [ngValue]="statusName.value" [attr.data-trayOpen]="statusName.type">{{statusName.name}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="searchFieldsSubmit relative inline">
                        <input  type="submit" class="btn btn-primary pull-right bg-igp searchSubmitBtn"  value="Search All Parameters"/>
                    </div>
                </form>

                <div class="text-center searchValidationError theme-red text-bold" *ngIf="searchReportFieldsValidation">One of the search parameters must be filled!</div>
            </div>

            <div class="col-sm-3 col-md-3 reprts-summary bg-white padding1" style="height:100%;" [style.width]="(getTopBlockWidth()).right">
                <div class="underLine paddingHalf text-bold">Summary</div>
                <div class="summaryBlockCont">
                    <div class="summaryBlock inline m-top-1" *ngFor="let summ of reportData.summary; index as i;" [style.width.%]="100/reportData.summary.length">
                        <div class="icon l" aria-hidden="true">
                            <img src="assets/images/icons/gift.svg" alt="orders" *ngIf="i === 0">
                            <img src="assets/images/icons/inr.svg" alt="inr" *ngIf="i === 1">
                            <img src="assets/images/icons/inr.svg" alt="inr" *ngIf="i === 2">
                        </div>
                        <div class="text-igp summaryLabel">{{summ.label}}</div>
                        <div class="text-bold">{{summ.value | number}}</div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-sm-12 col-md-12 table-area table-cont m-top-1" id="table-section">
                <div class="reportDwld pull-right btn btn-primary" (click)="downLoadCSV($event, reportType)" [ngClass]="{'disableBtn' : !reportData.tableData.length}">
                  Download <span class="glyphicon glyphicon-download-alt" title="Download Report"></span>
                </div>
                <table class="report-table table table-striped table-bordered table-curved fixed-headerx">
                    <thead class="bg-igp text-white" (click)="stopEventPropgation($event)">
                        <tr>
                            <th class="relative" [ngClass]="{'reportDate' : tableLabel === 'Date', 'hide' : isHiddenCell(tableLabel), 'selectedHeader' : reportLabelState[tableLabel]['filterdd']}" *ngFor="let tableLabel of reportData.tableHeaders; let a='index';">
                                <span>
                                    <span class="capitalize">{{tableLabel | replace : '_'}}</span>
                                    <span class="sortIcons" *ngIf="orginalReportData.tableData.length>0">
                                        <span class="icon s" aria-hidden="true" (click)="setReportsHeadersState($event, tableLabel, 'filterdd', false)" *ngIf="reportLabelState[tableLabel]['filterdd']">
                                            <img class="arrowU" src="assets/images/icons/arrowD.svg" alt="up-arrow">
                                        </span>
                                        <span class="icon s" aria-hidden="true" (click)="setReportsHeadersState($event, tableLabel, 'filterdd', true)" *ngIf="!reportLabelState[tableLabel]['filterdd']">
                                            <img class="" src="assets/images/icons/arrowD.svg" alt="down-arrow">
                                        </span>
                                    </span>
                                </span>

                                <div class="clearfix"></div>
                                <div class="removeFilter icon m" (click)="removeColumnFilter($event, tableLabel)" *ngIf="reportLabelState[tableLabel].filterValue">
                                    <img class="" src="assets/images/icons/removeFilter.png" alt="remove-filter" title="Remove Column Filter">
                                </div>

                                <div class="abs searchSortDd col-sm-12 col-md-12" [ngClass]="{'ddOpen' :reportLabelState[tableLabel]['filterdd'] ,'ddleft' : a==0, 'ddRight' : (a== reportData.tableHeaders.length-1)}" *ngIf="orginalReportData.tableData.length>0">
                                    <div class="col-sm-12 col-md-12 m-top-1 colSearchPadding">
                                        <div class="col-sm-6 col-md-6 no-padding left-align">Sort By : </div>
                                        <div class="col-sm-6 col-md-6 no-padding">
                                            <div class="col-sm-6 col-md-6 no-padding">
                                                A-Z
                                            </div>
                                            <div class="col-sm-6 col-md-6 no-padding" style="margin-left: -1.5em;">
                                                <div class="icon s" aria-hidden="true" (click)="sortTableCol($event, tableLabel, a, 'asc')" style="transform: translate(0,-0.5em);" [ngClass]="{'hideVisibility' :!reportLabelState[tableLabel]['sortdec']}">
                                                    <img class="arrowU" src="assets/images/icons/arrowD.svg" alt="inr" title="Sort asc">
                                                </div>

                                                <div class="icon s" aria-hidden="true" (click)="sortTableCol($event, tableLabel, a, 'desc')" style="transform: translate(0,-1.2em);" [ngClass]="{'hideVisibility' : !reportLabelState[tableLabel]['sortIncr']}">
                                                    <img class="" src="assets/images/icons/arrowD.svg" alt="inr" title="Sort desc">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="clearfix"></div>

                                    <form (ngSubmit)="f.form.valid && columnFilterSubmit($event)" #f="ngForm" attr.data-colname="{{tableLabel}}" attr.data-coldt="{{determineDataType(orginalReportData.tableData[0][tableLabel])}}" nonvalidate>
                                        <div class="col-sm-12 col-md-12 m-top-1 bg-grey colSearchPadding filter no-margin">
                                            <div class="col-sm-6 col-md-6 no-padding left-align">Filter By :  </div>
                                            <div class="col-sm-6 col-md-6 no-padding">

                                                <select class="col-sm-12 col-md-12 no-padding customSelect" name="filterby" [(ngModel)]="reportLabelState[tableLabel]['filterBy']" *ngIf="determineDataType(orginalReportData.tableData[0][tableLabel]) == 'string'">
                                                    <option value="=">Equal</option>
                                                    <option value="contains">Containing</option>
                                                </select>

                                                <select class="col-sm-12 col-md-12 no-padding customSelect" name="filterby" [(ngModel)]="reportLabelState[tableLabel]['filterBy']" *ngIf="determineDataType(orginalReportData.tableData[0][tableLabel]) == 'date' || determineDataType(orginalReportData.tableData[0][tableLabel]) == 'number'">
                                                    <option value="="> = </option>
                                                    <option value=">="> >= </option>
                                                    <option value="<="> <= </option>
                                                </select>
                                            </div>
                                        </div>

                                       <div class="clearfix"></div>

                                       <div class="m-top-1">
                                           <div class="col-sm-12 col-md-12 colSearchPadding">
                                                <input class="col-sm-12 col-md-12 " type="text" name="filterValue" [(ngModel)]="reportLabelState[tableLabel]['filterValue']" placeholder="Enter value to search" *ngIf="ifDate(tableLabel) != 'date'" >
                                               <my-date-picker class="col-sm-12 col-md-12" name="filterValue" placeholder="Select a date" [options]="myDatePickerOptions" [(ngModel)]="reportLabelState[tableLabel]['filterValue']"  *ngIf="ifDate(tableLabel) === 'date'"></my-date-picker>

                                           </div>
                                           <div class="col-sm-12 col-md-12 m-b-05 colSearchPadding">
                                               <input  class="col-sm-12 col-md-12" type="submit" class="btn btn-primary pull-right bg-igp colSearchSubmitBtn"  value="Search" />
                                           </div>
                                       </div>
                                   </form>

                                </div>

                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr  *ngIf="reportData.tableData.length == 0" style="font-size:2em;">
                            <td [colSpan]="reportData.tableHeaders.length">No Record Found</td>
                        </tr>

                        <tr class="reporTableRow" *ngFor="let tableRowValue of reportData.tableData; let dataIndex='index'" >
                            <td class="reportTableCell" style="word-break: break-word;" *ngFor="let tableCol of reportData.tableHeaders; let i='index'" [ngClass]="{'hide' : isHiddenCell(tableCol)}" [style.width]="tableCol === 'email'? 'auto' : 'auto' ">
                                <div class="tdTxt">
                                    <span *ngIf="tableCol == 'Component Image' || tableCol == 'Component_Image'" >
                                    <img class="clk" style="width: 5em;" src="{{productsCompURL}}th/{{getCellValue(tableRowValue[tableCol])}}" alt="{{getCellValue(tableRowValue[tableCol])}}" (click)="imagePreview($event, productsCompURL+'full/'+(getCellValue(tableRowValue[tableCol])))">
                                    </span>
                                    <span *ngIf="tableCol == 'Ship_Type'" >{{getDeliveryName(getCellValue(tableRowValue[tableCol])) | replace : '`updated'}}</span>
                                    <span *ngIf="ifDate(tableCol) == 'date'" >{{getCellValue(tableRowValue[tableCol]) | date : 'dd/MM/yy'}}</span>
                                    <span *ngIf="ifDate(tableCol) != 'date' && tableCol != 'Ship_Type' && tableCol != 'Component_Image' && tableCol != 'Component Image'" >
                                        <span *ngIf="getCellValue(tableRowValue[tableCol]) === 0">{{getCellValue(tableRowValue[tableCol])}}</span>
                                        <span *ngIf="getCellValue(tableRowValue[tableCol]) !== 0" [innerHTML]="getCellValue(tableRowValue[tableCol])  | replace : '`,[' "></span>
                                    </span>
                                    &nbsp; &nbsp; &nbsp;
                                    <span class="icon m" aria-hidden="true" *ngIf="tableCol === 'Order_No'" (click)="viewOrderDetail($event, getCellValue(tableRowValue[tableCol]))">
                                        <img src="assets/images/icons/view.svg" alt="inr">
                                    </span>
                                    <span class="icon" aria-hidden="true" *ngIf="tableCol === 'invoice number'" (click)="dwldInv($event, tableRowValue['orderId'], getCellValue(tableRowValue[tableCol]))">
                                        <span class="glyphicon glyphicon-download-alt" title="Download Invoice"></span>
                                    </span>
                                </div>

                                <!--update messgae start-->
                                    <div class="updateTxt" *ngIf="isUpdated(getCellValue(tableRowValue[tableCol])) === 'updating' || isUpdated(getCellValue(tableRowValue[tableCol])) === 'updated'">
                                        <div class="updateTxtMain" *ngIf="isUpdated(getCellValue(tableRowValue[tableCol])) === 'updating'"><app-loader></app-loader></div>
                                        <div class="updateTxtMain" *ngIf="isUpdated(getCellValue(tableRowValue[tableCol])) === 'updated'">Request sent!</div>
                                    </div>
                                <!--update messgae end-->

                                <!--<h6>{{reportData.tableDataAction | json}}</h6>-->
                                <div *ngIf="reportData.tableDataAction && reportData.tableDataAction.length" class="tableDataAction">
                                    <div class="tableDataActionBtn" *ngFor="let tableAction of reportData.tableDataAction">
                                        <!--{{tableAction[tableCol] | json}}-->
                                        <div class="tableactBtn" *ngFor="let actBtn of tableAction[tableCol]; let z='index'" (click)="actionBtnInvoke(actBtn, getCellValue(tableRowValue[tableCol]), tableRowValue, tableCol, dataIndex)">
                                            <span class="tableactBtntxt">{{getActBtnTxt(actBtn, getCellValue(tableRowValue[tableCol]))}}</span>
                                            <ng-container *ngIf="(z+1) < tableAction[tableCol].length"> &nbsp; |</ng-container>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>

                    </tbody>
                </table>
        </div>

        <div class="col-sm-12 col-md-12 center-align m-b-1" *ngIf="showMoreBtn">
            <div class="btn btn-primary bg-igp searchSubmitBtn" (click)="showMoreTableData($event)">Show more</div>
        </div>

    </div>
</div>

<app-orders-action-tray></app-orders-action-tray>